package Shot;

import Mapa.Element;
import Mapa.Map;
import Obstaculo.*;

public abstract class Shot extends Element{
	
	protected int speed, dx, dy, posInShots;
	
	protected String direction;
	
	public Shot(String dir, int x, int y, Map map, int speed, int posx, int posy){
		super("Disparo "+dir,x, y, map, posx, posy);
		this.speed=speed;
		direction=dir;
		assignIncrementDir(dir);
	}
	public void addPosInShots(int x){
		posInShots=x;
	}
	public boolean move(){
		boolean mov=true;
		Obstacle obs= null;
		if(dx!=0){
			int auxX= getNewPos(x+dx);
			if(((x+dx)<0)||((x+dx)>677)){
				mov=false;
			}
			else{
				obs=map.getObstacle(auxX, posY);
				if(obs==null){
					x+=dx;
					posX=auxX;
				}
				else{
					mov=false;
				}
			}
		}
		if(dy!=0){
			int auxY= getNewPos(y+dy);
			if(((y+dy)<0)||((y+dy)>677)){
				mov=false;
			}
			else{
				obs= map.getObstacle(posX, auxY);
				if(obs!=null){
					y+=dy;
					posY=auxY;
				}
				else{
					move=false;
				}
			}
		}
		map.repaint();
		return mov;
	}
	public int getWidth(){
		if((dx==-1)||(dx==1)){
			return 4;
		}
		else{
			return 3;
		}
	}
	public int getHeight(){
		if((dx==-1)||(dx==1)){
			return 4;
		}
		else{
			return 3;
		}
	}
	public int getWidht(){
		if((dx==-1)||(dx==1)){
			return 4;
		}
		else{
			return 3;
		}
	}
	private void assignIncrementDir(String dir){
		switch(dir){
		case "arriba":
			dx=0;dy=-1;
			break;
		case "abajo":
			dx=0;dy=1;
			break;
		case "izquierda":
			dx=-1;dy=0;
			break;
		case "derecha":
			dx=1;dy=0;
			break;
		}
	}
	private int getNewPos(int newPosGraph){
		int newPos=0;
		int aux1=0;
		int aux2=52;
		boolean found=false;
		for(int i=0;(i<map.getMap().length-1)&&(!found);i++){
			if((newPosGraph>=aux1)&&((newPosGraph+4)<aux2)){
				found=true;
			}
			else{
				if((newPosGraph<aux2)&&((newPosGraph+4)>=aux2)){
					found=true;
					if((direction=="abajo")||(direction=="derecha")){
						newPos++;
					}
				}
				else{
					aux1=aux2;
					aux2+=52;
					newPos++;
					}
			}
		}
		return newPos;
	}
}